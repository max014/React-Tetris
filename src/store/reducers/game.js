import * as actionTypes from '../actions/actionTypes';
import { updateGame } from '../../logic/updateGame';
import * as utility from '../../utility';

const initialState = {
	board: [[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0,0]],
	pieces: [],
	height: window.innerHeight,
	step: Math.floor(window.innerHeight/20),
	input: null,
	level: 0,
	score: 0,
	lines: 0,
	lost: false,
	scores: [],
	modalUp: false
}

const game = (state = initialState, action) => {
	switch(action.type){
		case actionTypes.START_GAME:
			return {
				...state,
				board: [[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0]],
				pieces: [],
				height: window.innerHeight,
				step: Math.floor(window.innerHeight/20),
				input: null,
				level: 0,
				score: 0,
				lines: 0,
				lost: false,
				modalUp: false
			}
		case actionTypes.UPDATE:
			const newState = updateGame(state);
			return {
				...state,
				pieces: newState.pieces,
				board: newState.board,
				input: null,
				score: newState.score,
				lines: newState.lines,
				level: newState.level,
				lost: newState.lost
			};
		case actionTypes.SET_INPUT:
			return {
				...state,
				input: action.input
			};
		case actionTypes.END:
			return {
				...state,
				modalUp: true
			};
		case actionTypes.POST_SCORE:
			utility.postScore(state.score);
			return state;
		case actionTypes.SET_SCORES:
			const scores = action.scores;
			return {
				...state,
				scores: scores
			}
		default:
			return state;
	}
};

export default game;